<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PSX Emulator - Psychology Project</title>
    <style>
        /* Maintaining the original dark aesthetic */
        body { background-color: #000; color: #fff; margin: 0; padding: 0; font-family: sans-serif; text-align: center; }
        #container { margin-top: 10px; }
        canvas { width: 100%; max-width: 800px; border: 2px solid #222; background: #111; }
        
        .menu-bar { 
            background: #1a1a1a; 
            padding: 20px; 
            border-top: 2px solid #333;
            margin-top: 10px;
        }

        .btn { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            margin: 5px; 
            cursor: pointer; 
            border-radius: 4px; 
            font-weight: bold;
            font-size: 14px;
        }
        .btn-save { background: #28a745; }
        .btn-load { background: #555; }
        
        #status { color: #888; margin-bottom: 10px; font-size: 13px; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

    <div id="container">
        <canvas id="canvas"></canvas>
    </div>

    <div class="menu-bar">
        <div id="status">Engine Status: Waiting...</div>

        <button class="btn" onclick="document.getElementById('file-input').click()">SELECT .BIN FILE TO START</button>
        <input type="file" id="file-input" accept=".bin" onchange="bootGame(this)">

        <hr style="border: 0; border-top: 1px solid #333; margin: 15px 0;">

        <button class="btn btn-save" onclick="exportSave()">DOWNLOAD SAVE (.MCD)</button>
        <button class="btn btn-load" onclick="document.getElementById('save-input').click()">UPLOAD SAVE (.MCD)</button>
        <input type="file" id="save-input" onchange="importSave(this)">
    </div>

    <script src="https://originnull40.github.io/psychology-project/PlayStation.js"></script>

    <script>
        // ALERT 1: Tells us the HTML is working and trying to load the script
        alert("HTML is running. Looking for PlayStation.js...");

        var Module = {
            canvas: document.getElementById('canvas'),
            onRuntimeInitialized: function() {
                // ALERT 2: Tells us the PlayStation.js file was successfully loaded and executed
                alert("ENGINE SUCCESS! The emulator is now ready.");
                document.getElementById('status').innerText = "Engine Ready. Click Select .BIN to begin.";
            }
        };

        function bootGame(input) {
            if (input.files && input.files[0]) {
                window.load(input.files[0]);
                document.getElementById('status').innerText = "Now Playing: " + input.files[0].name;
            }
        }

        async function exportSave() {
            const req = indexedDB.open("wasmemu_db");
            req.onsuccess = () => {
                const store = req.result.transaction("files").objectStore("files");
                const getReq = store.get("/home/web_user/.pcsx/memcards/card1.mcd");
                getReq.onsuccess = () => {
                    if (!getReq.result) return alert("No save found! Did you save at a memory card point in-game yet?");
                    const a = document.createElement("a");
                    const blob = new Blob([getReq.result.contents]);
                    a.href = URL.createObjectURL(blob);
                    a.download = "psx_memory_card.mcd";
                    a.click();
                };
            };
        }

        function importSave(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const req = indexedDB.open("wasmemu_db");
                req.onsuccess = () => {
                    const db = req.result;
                    db.transaction("files", "readwrite").objectStore("files").put({
                        contents: new Uint8Array(e.target.result),
                        timestamp: new Date()
                    }, "/home/web_user/.pcsx/memcards/card1.mcd");
                    alert("Memory Card Imported! You can now Select your .BIN and the game will see your progress.");
                };
            };
            reader.readAsArrayBuffer(input.files[0]);
        }
    </script>
</body>
</html>

